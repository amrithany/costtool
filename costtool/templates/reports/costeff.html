{% load humanize %}
 <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){                                                           
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
               m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
                        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70024304-1', 'auto');
      ga('send', 'pageview');
</script>
<head>
<h4><i>CostOut</i>&reg; 2015</h4>
</head>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<!--<script src="https://rawgithub.com/highslide-software/crossing-specific-value/master/crossing-specific-value.js"></script>-->
<div id="container" style="width:90%; height:400px;margin:0 auto;"></div>
<script type="text/javascript">
var mySeries = [];                                                                       
var progName = [];
var avgEff = [];
var avgCost = [];
</script> 

{% for prog in ProgList %}
<script type="text/javascript">
mySeries.push({name: '{{prog.short_name}}', data: [[{{prog.average_effect}},{{prog.average_cost}}]],marker: {radius: 6}});
$(function () {
    (function (HC) {

        Highcharts.Axis.prototype.renderArrow = function(axis) {
            var chart = axis.chart,
                options = axis.options.arrow,
                arrowLength = options.height,
                arrowWidth = options.width,
                arrowColor = options.color,
                isXAxis = axis.isXAxis,
                path = [],
                x = isXAxis ? axis.len + axis.chart.plotLeft : axis.chart.plotLeft + axis.offset,
                y = isXAxis ? axis.offset + chart.plotTop : chart.plotTop;

            if (isXAxis) {
                path.push(
                    'M',
                x, y,
                    'L',
                x,
                y - arrowWidth,
                x + arrowLength,
                y,
                x,
                y + arrowWidth,
                    'Z');
            } else {
                path.push(
                    'M',
                x, y,
                    'L',
                x - arrowWidth,
                y,
                x,
                y - arrowLength,
                x + arrowWidth,
                y,
                    'Z');
            }

            if (axis.options.arrow && options.enabled) {
                if (axis.arrow) {
                    axis.arrow.destroy();
                }

                axis.arrow = chart.renderer.path(path)
                    .attr({
                    stroke: arrowColor,
                        'stroke-width': 1,
                    fill: arrowColor,
                    zIndex: 10
                })
                    .add();
            }
        }


    }(Highcharts));

    function addArrow() {
        var chart = this;

        Highcharts.each(chart.xAxis, function (xAxis, i) {
            Highcharts.Axis.prototype.renderArrow(xAxis);
        });

        Highcharts.each(chart.yAxis, function (yAxis, i) {
            Highcharts.Axis.prototype.renderArrow(yAxis);
        });
    }

 $('#container').highcharts({
      chart: {
            //type: 'scatter',
            //zoomType: 'xy',
            renderTo: 'container',
            defaultSeriesType:'scatter',
            borderWidth:1,
            borderColor:'#ccc',
            marginLeft:70,
            marginRight:70,
            backgroundColor:'#eee',
            plotBackgroundColor:'#fff',
            events: {
                load: addArrow
                //redraw: addArrow
            }
        },
        title: {
            text: 'Cost-effectiveness ratios for the project: <i>{{ProjectName}}</i>'
        },
        subtitle: {
                text: 'Source: www.cbcsecosttoolkit.org'
            },
        legend: {
            layout: 'vertical'
        },

        xAxis: {
                 title: {
                 text: 'Effect size gain',
                 x: 150,
                 y: 65                                                                                                
                },
             arrow: {
                enabled: true,
                height: 5,
                width: 5,
                color: 'black'
             },
             startOnTick: true,
             endOnTick: true,
             showLastLabel: true,
             gridLineWidth: 1,
             tickInterval: 0.5,
             lineColor: 'black',
             crossing: 0,
             opposite: true
        },      
        yAxis: {
            title: {
                text: 'Average cost per participant'
            },
            arrow: {
                enabled: true,
                height: 5,
                width: 5,
                color: 'black'
            },
            //tickInterval: 5000,
            lineWidth: 1,
            lineColor: 'black',
            crossing: 0,
            showLastLabel: true,
            plotLines: [{
                value: 0,
                width: 1,
                color: '#808080'
            }]
        },
        series: mySeries,
        tooltip: {
          pointFormat: ' x: {point.x} y: {point.y}',
            valueSuffix: '',
            shared: true
        },
    },
   function(chart) { // on complete
   var point = chart.series;
   var path=[];
   chart.xAxis[0].setExtremes(-{{prog.MaxEff}},{{prog.MaxEff}});
   chart.yAxis[0].setExtremes(-{{prog.Max}},{{prog.Max}});
        chart.renderer.label('COST INEFFECTIVE QUADRANT', 68, 75, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add(); 
         chart.renderer.label('DECREASING COST EFFECTIVENESS', 68, 330, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
       
        chart.renderer.label('_____________________', 80, 305, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('<', 75, 310, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', 55, 255, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', 55, 250, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add(); 
        chart.renderer.label('|', 55, 245, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', 55, 240, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', 55, 235, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', 55, 230, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', 55, 225, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
       chart.renderer.label('|', 55, 220, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })  
            .add();
        chart.renderer.label('|', 55, 290, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', 55, 285, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })  
            .add();
        chart.renderer.label('|', 55, 280, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
         chart.renderer.label('|', 55, 275, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })  
            .add();
        chart.renderer.label('|', 55, 270, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', 55, 265, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })  
            .add();
        chart.renderer.label('|', 55, 260, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('^', 53, 217, 'callout', chart.plotLeft, chart.plotTop)
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('INCREASING COST EFFECTIVENESS', chart.plotWidth-130, 75, 'callout')
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('_________________________', chart.plotWidth-100,85, 'callout')
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('>', chart.plotWidth+50, 90, 'callout')
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', chart.plotWidth+75, 110, 'callout')
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', chart.plotWidth+75, 120, 'callout')
            .css({
                color: '#000000'
            })
            .add();                                                                                                                    
        chart.renderer.label('|', chart.plotWidth+75, 130, 'callout')
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', chart.plotWidth+75, 140, 'callout')
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', chart.plotWidth+75, 150, 'callout')
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', chart.plotWidth+75, 160, 'callout')
            .css({
                color: '#000000'
            })
            .add();
       chart.renderer.label('|', chart.plotWidth+75, 170, 'callout')
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', chart.plotWidth+75, 180, 'callout')
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('|', chart.plotWidth+75, 190, 'callout')
            .css({
                color: '#000000'
            })
            .add();
        chart.renderer.label('v', chart.plotWidth+75, 195, 'callout')
            .css({
                color: '#000000'
            })
            .add(); 
        chart.renderer.label('COST EFFECTIVE QUADRANT', chart.plotWidth-100, 330, 'callout')
            .css({
                color: '#000000'
            })
            .add();
});
});


</script>
{% endfor %}
